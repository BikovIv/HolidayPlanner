<!DOCTYPE html>
<html>
   <!-- xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security"> NOT WORKING FOR NOW TO FIND SOLUTION-->
   <head>
      <meta charset="utf-8">
      <title>Weather App</title>
      <meta name="apple-mobile-web-app-capable" content="yes">
      <meta charset="UTF-8">
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
      <link href="assets/css/bootstrap.min.css" rel="stylesheet">
      <link href="assets/css/font-awesome.min.css" rel="stylesheet">
      <link href="assets/css/main.css" rel="stylesheet">
      <link href="assets/css/cards-styles.css" rel="stylesheet">
      <link href="assets/css/cards-style.css" rel="stylesheet">
      <link href="assets/css/mini-dashboard.css" rel="stylesheet">
      <link href="assets/css/horizontal-navbar.css" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css2?family=Playfair+Display&family=Roboto:wght@300&display=swap" rel="stylesheet">
      <script src="js/vendor/jquery/jquery-1.12.1.min.js"></script>
      <script src="js/vendor/bootstrap/bootstrap.min.js"></script>
      <script src="js/main.js"></script>
   </head>
   <body>
      <!-- <div class="home-page"> -->
      <header>
         <!-- <div class="container"> --> 
         <div class="navbar">
            <div class="logo">
               <h2>BRAND</h2>
            </div>
            <ul class="links">
               <li class="active">
                  <a href="home.html">
                  <span class="glyphicon glyphicon-home" aria-hidden="true"></span>
                  <span class="nav-label">Начало</span>
                  </a>
               </li>
               <li>
                  <a href="friends.html">
                  <i class="fa fa-users" aria-hidden="true"></i>
                  <span class="nav-label">Приятели</span>
                  </a>
               </li>
               <li>
                  <a href="inbox.html">
                  <span class="glyphicon glyphicon-envelope" aria-hidden="true"></span>
                  <span class="nav-label">Известия</span>
                  </a>
               </li>
               <li>
                  <a href="profile.html">
                  <i class="fa fa-cogs" aria-hidden="true"></i>
                  <span class="nav-label">Профил</span>
                  </a>
               </li>
               <li>
                  <a href="index.html" id="logout">
                  <span class="glyphicon glyphicon-log-out" aria-hidden="true"></span>
                  <span class="nav-label">Изход</span>
                  </a>
               </li>
            </ul>
            <div class="right">
               <button>Dashboard</button>
            </div>
            <div class="toggle">
               <div class="line1"></div>
               <div class="line2"></div>
               <div class="line3"></div>
            </div>
         </div>
      </header>
      
      <div class="container">
         <!-- add activity begin -->
            <div class="mini-dashboard-container">
               <h2 class="main-title">Mini Dashboard</h2>
               <div class="row stat-cards">
                  <div class="col-md-6 col-xl-3">
                     <article class="stat-cards-item">
                        <div class="stat-cards-icon primary">
                           <i data-feather="bar-chart-2" aria-hidden="true"></i>
                        </div>
                        <div class="stat-cards-info">
                           <p class="stat-cards-info__num">1478 286</p>
                           <p class="stat-cards-info__title">Total visits</p>
                           <p class="stat-cards-info__progress">
                              <span class="stat-cards-info__profit success">
                              <i data-feather="trending-up" aria-hidden="true"></i>4.07%
                              </span>
                              Last month
                           </p>
                        </div>
                     </article>
                  </div>
               </div>
               <button id="add-activity" type="button" class="login-button" data-toggle="modal" onClick="renderUserActivityInsertForm()">Add new activity</button>
               <div id="activity-form-modal" class="modal fade" tabindex="-1" role="dialog">
                  <div class="modal-dialog modal-sm">
                     <div class="modal-content">
                        <div class="modal-header">
                           <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                           <h4 class="modal-title">Activity Data</h4>
                        </div>
                        <div class="modal-body">
                           <form id="activity-form"  method="POST" enctype="multipart/form-data">
                              <!-- action="/userActivity/add" -->
                              <div class="form-group">
                                 <label for="activitiy-select">Choose Activity type:</label>
                                 <select id="activitiy-select" name="activity_id" class="form-control">
                                    <option id="activitySelectCloneMe" value="0" selected>Select vacantion type...</option>
                                 </select>
                                 <p class="help-block">The field "Activity type" is empty</p>
                              </div>
                              <div class="form-group">
                                 <label for="description">Description</label>
                                 <input type="text" class="form-control" id="description" name="description" placeholder="description">
                                 <p class="help-block">The field "description" is empty</p>
                              </div>
                              <div class="form-group">
                                 <label for="title">Title</label>
                                 <input type="text" class="form-control" id="title" name="title" placeholder="title" value="">
                                 <p class="help-block">The field "title" is empty</p>
                              </div>
                              <div class="form-group">
                                 <label for="file">File to upload:<span class="" id="imgStatus"></span></label>
                                 <input type="file" name="file" id="activityImage"/>
                              </div>
                              <div class="form-group" style="display:none;">
                                 <input type="number" name="user_activity_id" id="user_activity_id" value="0"/>
                              </div>
                           </form>
                           <div>
                              <!--  <form id="image-form" method="POST" enctype="multipart/form-data" id="image-form">
                                 <table>
                                 	<tr><td>File to upload:</td><td><input type="file" name="file" id="activityImage"/></td></tr>
                                 	<tr><td></td><td><input type="submit" value="Upload"/></td></tr>
                                 </table>
                                 </form> -->
                           </div>
                           <!--  <div class="modal-footer">-->
                           <button id="addUserActivity" type="submit" form="activity-form" class="btn btn-success">Add Activity</button>
                           
                           <!--<labeL for="user_activity_search">Search user activities:</labeL>
                           <input type="text" id="user_activity_search"/>-->
                        </div>
                     </div>
                  </div>
                  <!-- /.modal-content -->
               </div>
               <!-- /.modal-dialog -->
               <!--   </div>  login-modal -->
            </div>
            <!-- add activity begin -->
            
  <form id="userActivity-search-form"  method="GET">
	  <div style="margin-top:20px; margin-bottom:20px">         
	 	<label for="activitiy-select-search">Search by Activity type:</label>
	            <select id="activitiy-select-search" name="activity_id" class="form-control" ><!-- onchange="getAllUserActivitiesByActivityId(value)" -->
	               <option id="activitySelectSearchCloneMe" value="1" style="display:none" >Select vacantion type...</option>
	            </select>
	            
	    <label for="activitiy-search-string">Search by Activity title:</label>           
	     <div class="search-container">
	      <input type="text" id="activitiy-search-string" name="title"><!-- onkeyup="getAllUserActivitiesByTitle(value)"/ -->    
	 	 </div>
	 	  <button id="searchUserActivity" type="submit" form="userActivity-search-form" class="btn btn-success">Search</button>
      </div>
  </form>         
  
                                 
           <div class="card" id="userActivityCloneMe" style="display:none;" onclick="renderUserActivityForm(id)">
			  <img src="" alt="Activity" style="width:100%">
			  <div class="card-body">
			    <h2><b>John Doe</b></h2> 
			    <p>Architect & Engineer</p> 
			    <p id="userActivityId" style="display:none"></p> 
			    <button id="deleteUserActivity" class="btn btn-success">Delete</button>
			  </div>
			</div>            
			           
         <div class="card-container" id="userActivitiy-list"></div>
         
         <footer class="footer" style="position: inherit;">
         <div class="container footer--flex">
           <div class="footer-start">
             <p>2023 © Elegant Dashboard - <a href="elegant-dashboard.com" target="_blank"
                 rel="noopener noreferrer">elegant-dashboard.com</a></p>
           </div>
           <ul class="footer-end">
             <li><a href="##">About</a></li>
             <li><a href="##">Support</a></li>
             <li><a href="##">Puchase</a></li>
           </ul>
         </div>
         </footer>
      </div>
               
     <script>   
     
     function renderUserActivityInsertForm(){
    	 
    	 //const form = document.forms['activity-form'];
    	 
    	 //console.log(form);
  		$('#activity-form-modal').modal('show');
  	}
     
  	function renderUserActivityForm(userActivityId){
 		console.log(userActivityId);
 		
 		const form = document.forms['activity-form'];
 		
 		$.ajax({
 			url: "/userActivity/getById",
 			method: "get",
 			data: {
 				id: userActivityId
 			},
 			success: function(data){
 					//console.log(data);	
 					//console.log(data.imagePath);	
 					
 					//console.log(document.forms['activity-form'].elements['file'].value);	
 					
 					document.forms['activity-form'].elements['title'].value = data.title;
 					document.forms['activity-form'].elements['description'].value = data.description;
 					//document.forms['activity-form'].elements['filename'].value = "";
 					document.forms['activity-form'].elements['activity_id'].value = data.activity.id;	
 					document.forms['activity-form'].elements['user_activity_id'].value = userActivityId;	
 			}
 		});
 		
 		
 		 //$('#description').val($(this).data('#description'));
 		
 		$('#activity-form-modal').modal('show');
 	}
  	
  	function getAllUserActivitiesBy(title, activity_id){  	
  		console.log(title);
 		//if(activity_id > 0){
 			//var doc = document.getElementById("userActivitiy-list");
 	        //doc.innerHTML = '';	
			
      		$.ajax({
      			url: "/userActivity/getBy",
      			method: "GET",
      			data: {title: title, 
      					activity_id: activity_id},
      			success: function(data){
      					//addUserActivityToUI(activity.title, activity.description, activity.imagePath, activity.id, activity.activity);
         		data.forEach(function(activity){
         			console.log(activity);
         			var theActivity = $('#userActivityCloneMe').clone();
         		theActivity.find('img').attr('src', activity.imagePath);
         		theActivity.find('h2').text(activity.title);
         		theActivity.find('p').text(activity.description);
         		theActivity.attr('id', activity.id);
         		
         		theActivity.find('button').click(function(){
         			deleteUserActivity(id, theActivity);
         		});

         		$('#userActivitiy-list').prepend(theActivity);
         		theActivity.show();   		
      			}); 
      			}
      		});
  		//}
 	}
  	
     
  	function getAllUserActivitiesByActivityId(activity_id){  	
   
 		if(activity_id > 0){
 			var doc = document.getElementById("userActivitiy-list");
 	        doc.innerHTML = '';	
 			//console.log(doc.childNodes);	
			
      		$.ajax({
      			url: "/userActivity/getByActivityId",
      			method: "GET",
      			data: {activity_id: activity_id},
      			success: function(data){
      					//addUserActivityToUI(activity.title, activity.description, activity.imagePath, activity.id, activity.activity);
	
         		data.forEach(function(activity){
         		var theActivity = $('#userActivityCloneMe').clone();
         		theActivity.find('img').attr('src', activity.imagePath);
         		theActivity.find('h2').text(activity.title);
         		theActivity.find('p').text(activity.description);
         		theActivity.attr('id', activity.id);
         		
         		theActivity.find('button').click(function(){
         			deleteUserActivity(id, theActivity);
         		});

         		$('#userActivitiy-list').prepend(theActivity);
         		theActivity.show();    		
      			});
      			}
      		});
  		}
 	}
  	
  	function getAllUserActivitiesByTitle(title){  	
  	   
 		if(title != ""){
 			var doc = document.getElementById("userActivitiy-list");
 	        doc.innerHTML = '';	
 			//console.log(doc.childNodes);	
			
      		$.ajax({
      			url: "/userActivity/getByTitle",
      			method: "GET",
      			data: {title: title},
      			success: function(data){
      					//addUserActivityToUI(activity.title, activity.description, activity.imagePath, activity.id, activity.activity);
	
         		data.forEach(function(activity){
         		var theActivity = $('#userActivityCloneMe').clone();
         		theActivity.find('img').attr('src', activity.imagePath);
         		theActivity.find('h2').text(activity.title);
         		theActivity.find('p').text(activity.description);
         		theActivity.attr('id', activity.id);
         		
         		theActivity.find('button').click(function(){
         			deleteUserActivity(id, theActivity);
         		});

         		$('#userActivitiy-list').prepend(theActivity);
         		theActivity.show();    		
      			});
      			}
      		});
  		}
 	}
  	
  	
         $(document).ready(function(){
        	// getAllUserActivitiesBy(7, 7); 
        	
        //search begin
        	
        	const search_text = document.getElementById("activitiy-search-string") ;	
         	const search_activity_id = document.getElementById("activitiy-select-search");
         	
         const searchForm = document.forms['userActivity-search-form'];
         const searchFormData = new FormData();
         
         const handleSearchSubmit = (event) => {
            event.preventDefault();	  
            //const form = document.forms['userActivity-search-form'];
			
			searchFormData.append("title", searchForm.title.value);
        	searchFormData.append("activity_id", searchForm.activity_id.value);	
			
        	for (const p of searchFormData){
        		console.log(p);
        	}
			
            console.log(searchFormData);
            	      	
            fetch("http://localhost:8080/userActivity/getBy", {
                method: "get",
                body: searchFormData
            }).then(response => response.text())
            .then((response) => {
                console.log(response);
                console.log("here");
            })
            .catch((error) => ("Something went wrong!", error));
         };
         
         searchForm.addEventListener("submit", handleSearchSubmit);    	
         
         //search end
        	
         	function addActivityToSelect(title, description, id){

         		var theActivity = $('#activitySelectCloneMe').clone();
         		
         		theActivity.attr('value', id); 
         		theActivity.attr('label', title);
         		//theActivity.find('option').attr('value', title);   
         		//theActivity.setAttribute("<value>", title);
         		//theActivity.find('p').text(description);
         		//theActivity.attr('id', '');
         		
         		//theActivity.find('img').attr('src', image);   
         		
         		//theActivity.find('button').click(function(){
         		//	deleteComment(id, theActivity);
         		//});
         		
         		$('#activitiy-select').prepend(theActivity);
         		
         		theActivity.show();    		
         	}
         	
         	function addActivityToSearchSelect(title, description, id){

         		var theActivity = $('#activitySelectSearchCloneMe').clone();
         		
         		theActivity.attr('value', id); 
         		theActivity.attr('label', title);
         		//theActivity.find('option').attr('value', title);   
         		//theActivity.setAttribute("<value>", title);
         		//theActivity.find('p').text(description);
         		//theActivity.attr('id', '');
         		
         		//theActivity.find('img').attr('src', image);   
         		
         		//theActivity.find('button').click(function(){
         		//	deleteComment(id, theActivity);
         		//});
         		
         		$('#activitiy-select-search').prepend(theActivity);
         		
         		theActivity.show();    		
         	}
         	
         	
         	
         	function getAllActivities(action){  	
         
         		if(action === "addToSelect"){
          		$.ajax({
          			url: "/activity/all",
          			method: "GET",
          			success: function(data){
          				data.forEach(function(activity){
          						addActivityToSelect(activity.title, activity.description, activity.id);
          						addActivityToSearchSelect(activity.title, activity.description, activity.id)
          				}); 
          				
          				/*const list = document.getElementById("activitiy-select").childNodes;	
          	 			for (i=1; i <= list.length; i++){
          	 				console.log(list[i].value);
          	 				if (list[i].value==0){
          	 					document.getElementById(0).remove();
          	 				}
          	 			}*/
          				
          			}	
          		});
         		}
         	}
         	
         function getAllUserAcivities(action){
       
         $.getJSON("/activity/all", function(data){				
         $.ajax({
          			url: "/userActivity/all",
          			method: "GET",
          			success: function(data){
          				if(action === "addUserActivityToUI"){
	          				data.forEach(function(activity){
	          					addUserActivityToUI(activity.title, activity.description, activity.imagePath, activity.id, activity.activity);
	          					//console.log(activity.imagePath);	
	          			
          					});  	
          				}else if(action === "getJSON"){
	          				//console.log(data);
          				const activityJson = data;
          				}
          			}    			
          		});
         
         					}); 		
         	}

         	function addActivity(data){
         		title = $('#select-city').val();
         		description = $('#comment').val();
         		imagePath = $('#imagePath').val();
         		
         		$.ajax({
         			url: "/comment/add",
         			method: "POST",
         			data: {
         				city: city,
         				temp: temp,
         		description: comment,
         		icon: icon
         			},
         			success: function(data){
         				if(data.includes("Error:")){
         					alert(data);
         				}else{
         					addCommentToUI(comment, city, temp, icon, data);
         				}
         			}
         		});
         	}
         	

         
         	
         	function addUserActivityToUI(title, description, imagePath, id, activity){
         		var theActivity = $('#userActivityCloneMe').clone();
         		
         		theActivity.find('img').attr('src', imagePath);
         		theActivity.find('h2').text(title);
         		//theActivity.find('h2').attr('value', title);
         		theActivity.find('p').text(description);
         		theActivity.attr('id', id);
         		//theActivity.find('#userActivitiy-list-details').text(activity.title + ": " + activity.description);
         		//theActivity.find('#userActivitiy-list-details-description').text(activity.description);
         		//userActivitiy-list-details
         		//image = 'assets/img/icons/';
         		//if(icons[icon] == undefined){
         		//	image += "clear_sky.png";
         		//}else{
         		//	image += icons[icon];
         		//}
         		
         		//theActivity.find('img').attr('src', image);   
         		
         		theActivity.find('button').click(function(){
         			
         			deleteUserActivity(id, theActivity);
         			$('#activity-form-modal').modal('hide');
         		});
         		
         		//theActivity.find('#userActivitiy-list-details').(function(){
         		//	$('#userActivitiy-list-details-description').hide();
         		//});
         		
         		$('#userActivitiy-list').prepend(theActivity);
         		
         		theActivity.show();    		
         	}
         	
         	
         	
         	
         	function deleteUserActivity(id, element){
         		$.ajax({
         			url: "/userActivity/delete",
         			method: "DELETE",
         			data: {
         				id: id
         			},
         			complete: function(data){
         				switch(data.status){
         				case 200:
         					element.remove(); 					
         					break;
         					
         				case 401:
         					windows.location.href = "index.html";
         					break;
         					
         				case 404:
         					alert("The comment was not found!");
         					element.remove();
         					break;
         				}
         			}
         		});
         	}
         	
         	
         	$('#logout').on('click', function(e){
             	e.preventDefault();
             	
             	$.ajax({
             		url: "logout",
             		method: "POST",
             		complete: function(data){
             			if(data.status == 418){
             				alert("Why are you a teapot?!");
             			}
             			
             			window.location.href = "index.html";
             		}
             	});
             	
             });
         	
         	//add activity + upload coosen image begin - WORK :@:@
         	
         	const title = document.getElementById("title") ;
         	const description = document.getElementById("description");
         	const activity_id = document.getElementById("activitiy-select");
         	const user_activity_id = document.getElementById("user_activity_id");
         	
         	const inputFile = document.getElementById("activityImage");
         	const imagePath = "../uploads/";
         const form = document.forms['activity-form'];
         const formData = new FormData();
         
         const handleSubmit = (event) => {
            event.preventDefault();	
            console.log(title.value);
            console.log(description.value);
            console.log(activity_id.value);
            const form = document.forms['activity-form'];
            
           	  formData.append("title", title.value);
        	  formData.append("description", description.value);
        	  formData.append("activity_id", activity_id.value);
        	  formData.append("imagePath", imagePath);
        	  formData.append("user_activity_id", user_activity_id.value);
            
            for (const file of inputFile.files) {	 
          	  formData.append("file", file);
            } 
               
            fetch("http://localhost:8080/userActivity/add", {
                method: "post",
                body: formData
            }).then(window.location.reload())
            .catch((error) => ("Something went wrong!", error));
         };
         
         form.addEventListener("submit", handleSubmit);    	
       //add activity + upload coosen image end - WORK :@:@
       
       
         	/*//upload coosen image - WORK :@:@
         const inputFile = document.getElementById("activityImage");
           	//console.log(inputFile);
         const form = this;
         const formData = new FormData();
         
         const handleSubmit = (event) => {
            event.preventDefault();	
         
            for (const file of inputFile.files) {
                formData.append("file", file);
            }
            
            for (const file of formData) {
          	  //console.log(file[1].name);
            }
            
            
            fetch("http://localhost:8080/upload", {
                method: "post",
                body: formData
            }).catch((error) => ("Something went wrong!", error));
         };
         
         form.addEventListener("submit", handleSubmit);
         	*/
         
         	 /*//WORK old case
         	 $('#activity-form').submit(function(e){
         	    	e.preventDefault();
         	    	
         	    	const inputFile = document.getElementById("activityImage");
         	    	console.log( inputFile.files[0].name);
         	    	//for (const file of inputFile.files) {
         	    	//	console.log(file);
         		      
         	    	
         	    	$.ajax({
         	    		url: "/userActivity/add",
         	    		method: "POST",
         	    		data: {
         		title : $('#title').val(),
         	    			description : $('#description').val(),
         	    			imagePath : "../uploads/" + inputFile.files[0].name, //$('#imagePath').val(), //ok "../uploads/test.png", 
         	    			activity_id : $('#activitiy-select').val()
         	    		},
         	    		success: function(data){
         	    			window.location.reload();
         	    		},
         	    		fail : function(){
         	    			alert("Request failed.....");
         	    		}    		
         	    	});
         	    	
         	    });*/   	
         	
         	getAllActivities("addToSelect");
         	getAllUserAcivities("addUserActivityToUI");
         	getAllActivities("getAll");
         });
         
      </script>
   </body>
</html>